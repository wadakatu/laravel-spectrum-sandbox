<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Spectrum Sandbox - Terminal</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/terminal.css">
    <link rel="stylesheet" href="/css/editor.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.1.0/css/xterm.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="sandbox-container">
        <!-- Header -->
        <div class="sandbox-header">
            <div class="header-left">
                <a href="/" class="btn btn-sm btn-outline-light">
                    <i class="bi bi-arrow-left"></i> Back
                </a>
                <span class="environment-badge" id="environment-name">Loading...</span>
            </div>
            <div class="header-center">
                <div class="btn-group" role="group">
                    <button class="btn btn-sm btn-primary" onclick="clearTerminal()">
                        <i class="bi bi-trash"></i> Clear
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="resetEnvironment()">
                        <i class="bi bi-arrow-clockwise"></i> Reset
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="downloadFiles()">
                        <i class="bi bi-download"></i> Download Files
                    </button>
                </div>
            </div>
            <div class="header-right">
                <span class="connection-status" id="connection-status">
                    <i class="bi bi-circle-fill"></i> Connected
                </span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="sandbox-content with-editor">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Command Palette -->
                <div class="panel">
                    <div class="panel-header">
                        <h6><i class="bi bi-command"></i> Commands</h6>
                    </div>
                    <div class="panel-body" id="command-palette">
                        <div class="command-group">
                            <div class="command-group-title">Generation</div>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:generate', event)" title="Generate OpenAPI documentation in JSON format">
                                <i class="bi bi-file-earmark-code"></i>
                                <span class="command-name">spectrum:generate</span>
                                <span class="command-desc">Generate OpenAPI (JSON)</span>
                            </button>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:generate --format=yaml', event)" title="Generate OpenAPI documentation in YAML format">
                                <i class="bi bi-file-earmark-text"></i>
                                <span class="command-name">spectrum:generate --format=yaml</span>
                                <span class="command-desc">Generate OpenAPI (YAML)</span>
                            </button>
                        </div>
                        <div class="command-group">
                            <div class="command-group-title">Development</div>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:watch', event)" title="Start live preview server with hot reload">
                                <i class="bi bi-eye"></i>
                                <span class="command-name">spectrum:watch</span>
                                <span class="command-desc">Live preview server</span>
                            </button>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:mock', event)" title="Start mock API server based on OpenAPI spec">
                                <i class="bi bi-server"></i>
                                <span class="command-name">spectrum:mock</span>
                                <span class="command-desc">Mock API server</span>
                            </button>
                        </div>
                        <div class="command-group">
                            <div class="command-group-title">Export</div>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:export:postman', event)" title="Export API documentation as Postman collection">
                                <i class="bi bi-box-arrow-up-right"></i>
                                <span class="command-name">export:postman</span>
                                <span class="command-desc">Export to Postman</span>
                            </button>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:export:insomnia', event)" title="Export API documentation as Insomnia collection">
                                <i class="bi bi-box-arrow-up-right"></i>
                                <span class="command-name">export:insomnia</span>
                                <span class="command-desc">Export to Insomnia</span>
                            </button>
                        </div>
                        <div class="command-group">
                            <div class="command-group-title">Cache</div>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:cache:clear', event)" title="Clear all Spectrum cache">
                                <i class="bi bi-trash3"></i>
                                <span class="command-name">cache:clear</span>
                                <span class="command-desc">Clear cache</span>
                            </button>
                            <button class="command-btn" onclick="runCommand('php artisan spectrum:cache:stats', event)" title="Show cache statistics">
                                <i class="bi bi-graph-up"></i>
                                <span class="command-name">cache:stats</span>
                                <span class="command-desc">Cache statistics</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- File Explorer -->
                <div class="panel">
                    <div class="panel-header">
                        <h6><i class="bi bi-folder-open"></i> Files</h6>
                        <button class="btn btn-sm btn-link" onclick="refreshFileTree()">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                    <div class="panel-body">
                        <div id="file-tree" class="file-tree">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Output Viewer -->
                <div class="panel">
                    <div class="panel-header">
                        <h6><i class="bi bi-file-earmark-text"></i> Output</h6>
                    </div>
                    <div class="panel-body">
                        <select class="form-select form-select-sm" id="output-selector" onchange="loadOutput()">
                            <option value="">Select output file...</option>
                            <option value="openapi.json">openapi.json</option>
                            <option value="openapi.yaml">openapi.yaml</option>
                            <option value="postman.json">postman.json</option>
                            <option value="insomnia.json">insomnia.json</option>
                        </select>
                        <div id="output-viewer" class="output-viewer mt-2">
                            <!-- Output content -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Terminal -->
            <div class="terminal-container">
                <div id="terminal"></div>
            </div>

            <!-- Code Editor -->
            <div class="editor-container">
                <div class="editor-header">
                    <div class="editor-tabs">
                        <span id="editor-header">No file selected</span>
                    </div>
                    <div class="editor-actions">
                        <div class="template-selector">
                            <button class="editor-action-btn" onclick="toggleTemplateDropdown()">
                                <i class="bi bi-file-code"></i> Templates
                            </button>
                            <div id="template-dropdown" class="template-dropdown">
                                <div class="template-item" onclick="loadTemplate('basic-api')">
                                    <div class="template-item-title">Basic API</div>
                                    <div class="template-item-desc">Simple CRUD controller with validation</div>
                                </div>
                                <div class="template-item" onclick="loadTemplate('complex-validation')">
                                    <div class="template-item-title">Complex Validation</div>
                                    <div class="template-item-desc">Advanced validation rules example</div>
                                </div>
                            </div>
                        </div>
                        <button class="editor-action-btn" onclick="saveFile()">
                            <i class="bi bi-save"></i> Save
                        </button>
                    </div>
                </div>
                <div id="code-editor"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.1.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.7.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.8.0/lib/xterm-addon-web-links.js"></script>
    
    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script src="/js/terminal.js"></script>
    <script src="/js/file-explorer.js"></script>
    <script src="/js/command-palette.js"></script>
    <script src="/js/editor.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>